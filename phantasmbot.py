import telebot
from telebot import types

TOKEN = "8255205522:AAGUqhhiaH8-4CBl-H4W8GgcQupTb44Grio"
bot = telebot.TeleBot(TOKEN)


QUESTIONS = {
    "–ª–µ–≥–∫–∏–π": [
        (
            "–°—Ç–æ–ª–∏—Ü–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞?",
            ["–ê—Å—Ç–∞–Ω–∞", "–ê–ª–º–∞—Ç—ã", "–®—ã–º–∫–µ–Ω—Ç"],
            0,
            "–ê—Å—Ç–∞–Ω–∞ —Å—Ç–∞–ª–∞ —Å—Ç–æ–ª–∏—Ü–µ–π –≤ 1997 –≥–æ–¥—É"),
        (
            "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫?",
            ["–ê–π—Ä–∞–Ω", "–ß–∞–π", "–ö—É–º—ã—Å"],
            2,
            "–ö—É–º—ã—Å - —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω —Å –∫–æ—á–µ–≤–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–æ–π"),
        (
            "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω ‚Äî —ç—Ç–æ?",
            ["–°–æ–¥—Ä—É–∂–µ—Å—Ç–≤–æ", "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ", "–§–µ–¥–µ—Ä–∞—Ü–∏—è"],
            1,
            "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω –ø—Ä–∏–∑–Ω–∞–Ω –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ–º —Ç–∞–∫ –∫–∞–∫ –æ–±–ª–∞–¥–∞–µ—Ç –≤—Å–µ–º–∏ –µ–≥–æ –∫–ª—é—á–µ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏"),
        (
            "–ì–æ–¥ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏?",
            ["1991", "1989", "2000"],
            0,
            "–∏–º–µ–Ω–Ω–æ 16 –¥–µ–∫–∞–±—Ä—è 1991 –≥–æ–¥–∞ –í–µ—Ä—Ö–æ–≤–Ω—ã–π –°–æ–≤–µ—Ç –ö–∞–∑–∞—Ö—Å–∫–æ–π –°–°–† –ø—Ä–∏–Ω—è–ª –∑–∞–∫–æ–Ω –æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"),
        (
            "–ù–∞—Ü. –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?",
            ["–î–æ–º–±—Ä–∞", "–ì–∏—Ç–∞—Ä–∞", "–°–∫—Ä–∏–ø–∫–∞"],
            0,
            "–î–æ–º–±—Ä–∞ - –¥—Ä–µ–≤–Ω–µ–π—à–µ–µ –Ω–∞—Å–ª–µ–¥–∏–µ –∏ –¥—É—â–∞ –Ω–∞—Ä–æ–¥–∞."),
        (
            "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —è–∑—ã–∫?",
            ["–†—É—Å—Å–∫–∏–π", "–ö–∞–∑–∞—Ö—Å–∫–∏–π", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π"],
            1,
            "–û–Ω —è–≤–ª—è–µ—Ç—Å—è —è–∑—ã–∫–æ–º —Ç–∏—Ç—É–ª—å–Ω–æ–π –Ω–∞—Ü–∏–∏"),
        (
            "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞?",
            ["–†—É–±–ª—å", "–î–æ–ª–ª–∞—Ä", "–¢–µ–Ω–≥–µ"],
            2,
            "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–Ω–≥–µ –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Ç—é—Ä–∫—Å–∫–æ–µ —Å–ª–æ–≤–æ, –≤ –ø–µ—Ä–µ–≤–æ–¥–µ —Ç–∞–Ω—å–≥–∞-–¥–µ–Ω—å–≥–∏"),
        (
            "–ì–ª–∞–≤–Ω–∞—è —Ä–µ–∫–∞?",
            ["–ò—Ä—Ç—ã—à", "–ù–∏–ª", "–ê–º–∞–∑–æ–Ω–∫–∞"],
            0,
            "–ò—Ä—Ç—ã—à - —Å–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ –ø—Ä–æ—Ç–µ–∫–∞—é—â–∞—è –ø–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞"),
        (
            "–ü—Ç–∏—Ü–∞ –Ω–∞ —Ñ–ª–∞–≥–µ?",
            ["–í–æ—Ä–æ–±–µ–π", "–ë–µ—Ä–∫—É—Ç", "–û—Ä–µ–ª"],
            1,
            "–û–Ω —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –º—É–¥—Ä–æ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥—É"),
        (
            "–ö–∞–∫–æ–µ –º–æ—Ä–µ –µ—Å—Ç—å –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ?",
            ["–ö—Ä–∞—Å–Ω–æ–µ", "–ë–∞–ª—Ç–∏–π—Å–∫–æ–µ", "–ö–∞—Å–ø–∏–π—Å–∫–æ–µ"],
            2,
        "–ö–∞—Å–ø–∏–π—Å–∫–æ–µ –º–æ—Ä–µ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞"),
    ],

    "—Å—Ä–µ–¥–Ω–∏–π": [
        (
            "–ê–≤—Ç–æ—Ä —Ä–æ–º–∞–Ω–∞ –ü—É—Ç—å –ê–±–∞—è?",
            ["–ö—É–Ω–∞–Ω–±–∞–µ–≤", "–ê—É—ç–∑–æ–≤", "–°–µ–π—Ñ—É–ª–ª–∏–Ω"],
            1,
            "–ê—É—ç–∑–æ–≤ –Ω–∞–ø–∏—Å–∞–ª  —ç—Ç—É —ç–ø–æ–ø–µ—é –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω —Ö–æ—Ç–µ–ª —É–≤–µ–æ–∫–≤–µ—á–∏—Ç—å —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ê–±–∞—è"),
        ("–û—Ä–¥–∞ –ê–±—ã–ª–∞—è",
         ["–°—Ä–µ–¥–Ω–∏–π –∂—É–∑", "–ú–ª–∞–¥—à–∏–π –∂—É–∑", "–°—Ç–∞—Ä—à–∏–π –∂—É–∑"],
         0,
         "–û—Ä–¥–∞ –ê–±—ã–ª–∞—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –±—ã–ª–∞ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–Ω–∞ —Å–æ –°—Ä–µ–¥–Ω–∏–º –∂—É–∑–æ–º, –∑–∞–Ω–∏–º–∞—è –µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏"),
        ("–°—Ç–µ–ø—å ‚Äî —ç—Ç–æ?", ["–†–∞–≤–Ω–∏–Ω–∞", "–ì–æ—Ä—ã", "–õ–µ—Å"], 0),
        (
            "–•–∞–Ω—Å—Ç–≤–æ –æ—Å–Ω–æ–≤–∞–Ω–æ –≤?",
            ["1465", "1500", "1400"],
            0,
            "—Å—É–ª—Ç–∞–Ω—ã –ö–µ—Ä–µ–π –∏ –ñ–∞–Ω–∏–±–µ–∫, –Ω–µ–¥–æ–≤–ª—å–Ω—ã–µ –≤–ª–∞—Å—Ç—å—é —Ö–∞–Ω–∞ –ê–±—É–ª—Ö–∞–∏—Ä–∞, –≤–æ –≥–ª–∞–≤–µ —Å–≤–æ–∏—Ö –ø–ª–µ–º–µ–Ω"),
        ("–Æ—Ä—Ç–∞ ‚Äî —ç—Ç–æ?", ["–î–æ–º", "–û–¥–µ–∂–¥–∞", "–ï–¥–∞"], 0,),
        (
            "–î–µ–Ω—å –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏–∏?",
            ["16 –¥–µ–∫–∞–±—Ä—è", "22 –º–∞—Ä—Ç–∞", "30 –∞–≤–≥—É—Å—Ç–∞"],
            2,
        "–ò–º–µ–Ω–Ω–æ 30 –∞–≤–≥—É—Å—Ç–∞ 1995 –≥–æ–¥–∞, –±—ã–ª–∞ –ø—Ä–∏–Ω—è—Ç–∞ –¥–µ–π—Å—Ç–≤—É—é—â–∞—è –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω"),
        (
            "–î—É—Ö–æ–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä?",
            ["–ê—Å—Ç–∞–Ω–∞", "–¢—É—Ä–∫–µ—Å—Ç–∞–Ω", "–ê–∫—Ç–æ–±–µ"],
            1,
            "–û–Ω —è–≤–ª—è–µ—Ç—Å—è —Å–≤—è—â–µ–Ω–Ω—ã–º –¥–ª—è —Ç—é—Ä–∫—Å–∫–æ–≥–æ –º–∏—Ä–∞, –º–µ—Å—Ç–æ–º —É–ø–æ–∫–æ–µ–Ω–∏—è –≤–µ–ª–∏–∫–æ–≥–æ —Å—É—Ñ–∏—è –•–æ–¥–∂–∏ –ê—Ö–º–µ–¥–∞ –Ø—Å–∞–≤–∏"),
        ("–ê–≤—Ç–æ—Ä ¬´–°–ª–æ–≤ –Ω–∞–∑–∏–¥–∞–Ω–∏—è¬ª?", ["–ñ–∞–±–∞–µ–≤", "–ñ—É–º–∞–±–∞–µ–≤", "–ê–±–∞–π"], 2),
        ("–ì–æ—Ä–æ–¥ –Ω–∞ –®—ë–ª–∫–æ–≤–æ–º –ø—É—Ç–∏?", ["–û—Ç—Ä–∞—Ä", "–†–∏–º", "–ú–æ—Å–∫–≤–∞"], 0),
        (
            "–ë–µ—à–±–∞—Ä–º–∞–∫ –≥–æ—Ç–æ–≤—è—Ç –∏–∑?",
            ["–ú—è—Å–æ –∏ —Ç–µ—Å—Ç–æ", "–†–∏—Å", "–û–≤–æ—â–∏"],
            0,
            "–ë–µ—à–ø–∞—Ä–º–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ –º—è—Å–∞, –∏ —Ç–µ—Å—Ç–∞. –ü–æ–¥–∞–µ—Ç—Å—è —Å –∫—Ä–µ–ø–∫–∏–º –±—É–ª—å–æ–Ω–æ–º, –∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö —Å –æ–≤–æ—â–∞–º–∏"),
    ],

    "—Å–ª–æ–∂–Ω—ã–π": [
        (
            "–ü–µ—Ä–≤—ã–π —Ö–∞–Ω?",
            ["–ö–µ—Ä–µ–π", "–ê–±—ã–ª–∞–π", "–ö–∞—Å—ã–º"],
            0,
            "–ö–µ—Ä–µ–π –∏ –ñ–∞–Ω–∏–±–µ–∫, –±—É–¥—É—á–∏ –ø–æ—Ç–æ–º–∫–∞–º–∏ —á–∏–Ω–≥–∏–∑–∏–¥–æ–≤ —Å–æ–∑–¥–∞–ª–∏ –≤–æ–µ–Ω–Ω—É—é —Å–∏–ª—É –∏ –ø—Ä–æ–≤–∞–∑–≥–ª–∞—Å–∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –≥–æ—Å-–≤–∞"),
        (
            "–ñ–µ—Ç—ã –∂–∞—Ä–≥—ã ‚Äî —ç—Ç–æ?",
            ["–ó–∞–∫–æ–Ω—ã", "–ü–µ—Å–Ω–∏", "–ì–æ—Ä–æ–¥–∞"],
            0,
            "–ñ–µ—Ç—ã –∂–∞—Ä–≥—ã —Å–≤–æ–¥ –∑–∞–∫–æ–Ω–æ–≤ –ø—Ä–Ω—è—Ç—ã—Ö —Ö–∞–Ω–æ–º –¢–∞—É–∫–µ"),
        (
            "–¢—é—Ä–∫—Å–∫–∏–π –∫–∞–≥–∞–Ω–∞—Ç?",
            ["VI –≤–µ–∫", "X –≤–µ–∫", "III –≤–µ–∫"],
            0),
        (
            "–ê–ª–∞—à –û—Ä–¥–∞?",
            ["–ê–≤—Ç–æ–Ω–æ–º–∏—è", "–ì–æ—Ä–æ–¥", "–†–æ–¥"],
            0,
            "–ê–ª–∞—à –æ—Ä–¥–∞ —Å–∞–º–æ—É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å—Ç—Ä–µ–º–∏–ª–æ—Å—å –∫ –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-—Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ–Ω–æ–º–∏–∏"),
        ("–¢–æ–º–∏—Ä–∏—Å –ø–æ–±–µ–¥–∏–ª–∞?",
            ["–ö–∏—Ä–∞", "–î–∞—Ä–∏—è", "–ê—Ç—Ç–∏–ª—É"],
            0,
            "–¢–æ–º–∏—Ä–∏—Å –ø–æ–±–µ–¥–∏–ª–∞ –ö–∏—Ä–∞ –≤ –±–∏—Ç–≤–µ –Ω–∞ –µ–≥–æ —Å–µ–≤–µ—Ä–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü–µ –≤ 5 –≤–µ–∫–µ –¥–æ –Ω–∞—à–µ–π —ç—Ä—ã"),
        (
            "–û—Å–Ω–æ–≤–∞–Ω–∏–µ —Ö–∞–Ω—Å—Ç–≤–∞?", ["1465", "1456", "1501"], 0),
        ("–û—Å–Ω–æ–≤–∞—Ç–µ–ª–∏ —Ö–∞–Ω—Å—Ç–≤–∞?",
         ["–ö–µ—Ä–µ–π –∏ –ñ–∞–Ω–∏–±–µ–∫", "–ê–±—ã–ª–∞–π", "–ö–∞—Å—ã–º"], 0),
        ("–ñ–µ—Ç—ã –∂–∞—Ä–≥—ã –ø—Ä–∏–Ω—è—Ç –ø—Ä–∏?",
         ["–¢–∞—É–∫–µ —Ö–∞–Ω", "–ï—Å–∏–º —Ö–∞–Ω", "–ê–±—ã–ª–∞–π —Ö–∞–Ω"], 0),
        ("–í–æ—Å—Å—Ç–∞–Ω–∏–µ 1837‚Äì1847?",
         ["–ö–µ–Ω–µ—Å–∞—Ä—ã", "–°—ã—Ä—ã–º", "–ò—Å–∞—Ç–∞–π"], 0),
        ("–°—Ç–æ–ª–∏—Ü–∞ –ø—Ä–∏ –¢–∞—É–∫–µ —Ö–∞–Ω–µ?",
         ["–¢—É—Ä–∫–µ—Å—Ç–∞–Ω", "–°—É–∑–∞–∫", "–°—ã–≥–Ω–∞–∫"], 0),
    ]
}

state = {}
stats = {}
user_name = {}




@bot.message_handler(commands=['start'])
def start(message):
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add("–æ–± –∏–≥—Ä–µ", "–Ω–∞—á–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É", "–º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    bot.send_message(
        message.chat.id,
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –≠—Ç–æ - —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ –∫–∞–∑–∞—Ö—Å–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫—É–ª—å—Ç—É—Ä–µ. –•–æ—Ä–æ—à–µ–π –∏–≥—Ä—ã!\n" "–∫–æ–º–∞–Ω–¥–∞ 46 - phantasm", reply_markup=kb)




@bot.message_handler(func=lambda m: True)
def menu(message):
    cid = message.chat.id
    text = message.text

    if text == "–Ω–∞—á–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É":
        if cid not in user_name:
            bot.send_message(cid, "–í–≤–µ–¥–∏—Ç–µ –∏–º—è:")
            bot.register_next_step_handler(message, register)
        else:
            choose_level(message)

    elif text in ["–ª–µ–≥–∫–∏–π", "—Å—Ä–µ–¥–Ω–∏–π", "—Å–ª–æ–∂–Ω—ã–π"]:
        if cid not in stats:
            stats[cid] = {"right": 0, "wrong": 0}

        state[cid] = {
            "lvl": text,
            "i": 0,
            "answers": [],
            "right": 0,
            "wrong": 0
        }

        ask_question(message)

    elif text == "–º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
        if cid in stats:
            bot.send_message(
                cid,
                f"üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è:\n"
                f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {stats[cid]['right']}\n"
                f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {stats[cid]['wrong']}"
            )
        else:
            bot.send_message(cid, "–í—ã –µ—â—ë –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É.")

    elif text == "–æ–± –∏–≥—Ä–µ":
        bot.send_message(cid, "kazakh_travel - —ç—Ç–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ –∫–∞–∑–∞—Ö—Å—Ç–∫–æ–π –∫—É–ª—å—Ç—É—Ä–µ –∏ –∏—Å—Ç–æ—Ä–∏–∏! –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ–¥–æ–π–¥–µ—Ç –∫–∞–∫ –∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–æ–∏—Ö –∑–Ω–∞–Ω–∏–π, —Ç–∞–∫ –∏ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —á—Ç–æ —Ç–æ –Ω–æ–≤–æ–µ.")

    elif cid in state:
        check_answer(message)




def register(message):
    user_name[message.chat.id] = message.text
    bot.send_message(
        message.chat.id,
        f"–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è! –í–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {message.text}"
    )
    choose_level(message)



def choose_level(message):
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add("–ª–µ–≥–∫–∏–π", "—Å—Ä–µ–¥–Ω–∏–π", "—Å–ª–æ–∂–Ω—ã–π")
    bot.send_message(
        message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:",
        reply_markup=kb
    )



def ask_question(message):
    cid = message.chat.id
    s = state[cid]

    q, opts, _, _ = QUESTIONS[s["lvl"]][s["i"]]

    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    for o in opts:
        kb.add(o)

    bot.send_message(cid, q, reply_markup=kb)




def check_answer(message):
    cid = message.chat.id
    s = state[cid]

    item = QUESTIONS[s["lvl"]][s["i"]]

    q = item[0]
    opts = item[1]
    correct = item[2]
    explanation = item[3] if len(item) > 3 else None  # ‚Üê –í–ê–ñ–ù–û

    user_answer = message.text
    correct_answer = opts[correct]

    is_correct = correct_answer == user_answer

    s["answers"].append(
        (q, user_answer, correct_answer, explanation, is_correct)
    )

    if is_correct:
        s["right"] += 1
        stats[cid]["right"] += 1
    else:
        s["wrong"] += 1
        stats[cid]["wrong"] += 1

    s["i"] += 1

    if s["i"] == len(QUESTIONS[s["lvl"]]):
        show_results(cid)
        del state[cid]
    else:
        ask_question(message)




def show_results(chat_id):
    s = state[chat_id]
    name = user_name.get(chat_id, "")

    text = f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî {name}\n\n"

    for i, (q, user_ans, correct_ans, explanation, ok) in enumerate(s["answers"], start=1):
        mark = "‚úÖ" if ok else "‚ùå"
        text += (
            f"{i}. –í–æ–ø—Ä–æ—Å:\n{q}\n"
            f"–í–∞—à –æ—Ç–≤–µ—Ç: {user_ans} {mark}\n"
            f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {correct_ans}\n"
        )

        if not ok:
            text += f"–ü–æ—è—Å–Ω–µ–Ω–∏–µ: {explanation}\n"

        text += "\n"

    text += (
        f"–ò—Ç–æ–≥ –∑–∞ —ç—Ç—É –∏–≥—Ä—É:\n"
        f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {s['right']}\n"
        f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {s['wrong']}"
    )

    bot.send_message(chat_id, text)
    show_main_menu(chat_id)




def show_main_menu(chat_id):
    kb = types.ReplyKeyboardMarkup(resize_keyboard=True)
    kb.add("–æ–± –∏–≥—Ä–µ", "–Ω–∞—á–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É", "–º–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    bot.send_message(chat_id, "–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.", reply_markup=kb)




bot.polling()


